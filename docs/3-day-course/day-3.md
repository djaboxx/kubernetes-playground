# Day 3: Continuous Delivery & Observability

## Argo CD Introduction

### What is Argo CD?
Argo CD is a declarative, GitOps continuous delivery tool for Kubernetes. It automates the deployment of applications to Kubernetes clusters.

### Key Concepts
- **Application**: A resource that defines the desired state of an application in a Kubernetes cluster.
- **Project**: A resource that groups applications and provides RBAC policies.
- **Repository**: A Git repository that contains the application manifests.

### Setting Up Argo CD
1. **Install Argo CD**:
    ```sh
    kubectl create namespace argocd
    kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
    ```
2. **Access the Argo CD UI**:
    ```sh
    kubectl port-forward svc/argocd-server -n argocd 8080:443
    ```
    Open your browser and navigate to `https://localhost:8080`.

## GitOps Principles

### What is GitOps?
GitOps is a set of practices that uses Git as the single source of truth for declarative infrastructure and applications.

### Key Principles
- **Declarative Descriptions**: All infrastructure and application configurations are described declaratively.
- **Version Control**: All configurations are stored in Git repositories, providing version control and auditability.
- **Automated Delivery**: Changes to configurations are automatically applied to the infrastructure and applications.
- **Continuous Reconciliation**: The desired state defined in Git is continuously reconciled with the actual state of the infrastructure and applications.

## Application Deployment Patterns

### Blue-Green Deployment
Blue-Green Deployment is a pattern where two identical environments (blue and green) are maintained. Traffic is switched between the two environments to minimize downtime during deployments.

### Canary Deployment
Canary Deployment is a pattern where a new version of an application is gradually rolled out to a small subset of users before being rolled out to the entire user base.

### Rolling Deployment
Rolling Deployment is a pattern where a new version of an application is gradually rolled out to all users, replacing the old version incrementally.

## Prometheus Basics

### What is Prometheus?
Prometheus is an open-source monitoring and alerting toolkit designed for reliability and scalability.

### Key Concepts
- **Metrics**: Data points collected from monitored systems.
- **Targets**: Systems that Prometheus monitors for metrics.
- **Scraping**: The process of collecting metrics from targets.
- **Alerting**: The process of generating alerts based on collected metrics.

### Setting Up Prometheus
1. **Install Prometheus**:
    ```sh
    helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
    helm repo update
    helm install prometheus prometheus-community/prometheus --namespace monitoring --create-namespace
    ```
2. **Access the Prometheus UI**:
    ```sh
    kubectl port-forward svc/prometheus-server -n monitoring 9090:80
    ```
    Open your browser and navigate to `http://localhost:9090`.

## Metrics Collection

### Exporters
Exporters are tools that collect metrics from various systems and expose them in a format that Prometheus can scrape.

### Instrumentation
Instrumentation is the process of adding code to an application to expose metrics in a format that Prometheus can scrape.

## Alert Configuration

### Alertmanager
Alertmanager is a component of the Prometheus ecosystem that handles alerts generated by Prometheus.

### Configuring Alerts
1. **Create an Alerting Rule**:
    ```yaml
    groups:
    - name: example-alerts
      rules:
      - alert: HighCPUUsage
        expr: node_cpu_seconds_total{mode="idle"} < 20
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "High CPU usage detected"
          description: "CPU usage is above 80% for more than 5 minutes."
    ```
    Apply the rule:
    ```sh
    kubectl apply -f alerting-rules.yaml
    ```

## Grafana Dashboards

### What is Grafana?
Grafana is an open-source platform for monitoring and observability. It provides dashboards and visualization tools for metrics collected by Prometheus.

### Setting Up Grafana
1. **Install Grafana**:
    ```sh
    helm repo add grafana https://grafana.github.io/helm-charts
    helm repo update
    helm install grafana grafana/grafana --namespace monitoring --create-namespace
    ```
2. **Access the Grafana UI**:
    ```sh
    kubectl port-forward svc/grafana -n monitoring 3000:80
    ```
    Open your browser and navigate to `http://localhost:3000`.

### Creating Dashboards
1. **Add a Data Source**: Configure Prometheus as a data source in Grafana.
2. **Create a Dashboard**: Use the Grafana UI to create a new dashboard and add panels to visualize metrics.

## Conclusion
By following this 3-day training course, you have learned the fundamentals of Kubernetes, Helm, Ingress NGINX, Cert-Manager, Argo CD, GitOps, Prometheus, and Grafana. These tools and practices will help you manage and monitor your Kubernetes cluster effectively.
